«REM»
	Template for ejb3-Association
	
	@author		tobias haubold (old association handling)
	@author		andre pflueger
	@date		2008/09/08

«ENDREM»

«REM» based on genesez meta model «ENDREM»
«IMPORT gcore»

«REM» useful metamodel extensions «ENDREM»
«EXTENSION de::genesez::platforms::common::log::Log»

«EXTENSION de::genesez::platforms::common::AccessHelper»
«EXTENSION de::genesez::platforms::common::Conversion»
«EXTENSION de::genesez::platforms::common::GeneralHelper»
«EXTENSION de::genesez::platforms::common::typemapping::TypeMapping»

«EXTENSION de::genesez::platforms::java::scripts::Type»
«EXTENSION de::genesez::platforms::java::scripts::Naming»
«EXTENSION de::genesez::platforms::java::scripts::Conversion»
«EXTENSION de::genesez::platforms::java::ejb3::scripts::Conversion»
«EXTENSION de::genesez::platforms::java::ejb3::scripts::Naming»
«EXTENSION de::genesez::platforms::java::ejb3::scripts::Stereotypes»
«EXTENSION de::genesez::platforms::java::ejb3::scripts::AccessHelper»


«REM»
	public functions
«ENDREM»


«REM»
	generate attributes for a class
«ENDREM»
«DEFINE AssociationDecl FOR MClass-»
	«REM»«EXPAND _AssocClassReferences FOR ownedAssociation-»«ENDREM»
	«EXPAND AssociationDecl FOREACH property.typeSelect(MAssociationRole)-»
«ENDDEFINE»

«REM»
	generate attributes for a classifier
«ENDREM»
«DEFINE AssociationDecl FOR MClassifier-»
	«EXPAND AssociationDecl FOREACH property.typeSelect(MAssociationRole)-»
«ENDDEFINE»

«REM»
	generate a declaration for an attribute
«ENDREM»
«DEFINE AssociationDecl FOR MAssociationRole-»
	«EXPAND _CommentAssociation-»
	«IF isPlainAssociation()-»
		«EXPAND _Annotation-»
		«IF multiplicity == 1-»
			«EXPAND _Modifier» «type.asTypeName()-» «asAttribute()-»;
		«ELSE-»
			«REM»//Stereotypen: «this.stereotype»«ENDREM»
			«IF !hasStereotype("ejb3Association")-»
				@org.hibernate.annotations.CollectionOfElements
			«ENDIF-»
			«EXPAND _Modifier» «mapType()»<«type.asTypeName()-»> «asAttribute()» = new «mapType("Implementation")»<«type.asTypeName()-»>();
		«ENDIF-»
	«ELSE-»
		«REM»«EXPAND _Modifier» «mapType()»<«type.asTypeName()-»> «asAttribute()» = new «mapType("Implementation")»<«type.asTypeName()-»>();«ENDREM»
	«ENDIF»
«ENDDEFINE»


«REM»
	private functions
«ENDREM»


«REM» 
	evaluates the associations
«ENDREM»
«DEFINE _Annotation FOR MAssociationRole-»
	«IF hasStereotype("ejb3Association")-»
		«EXPAND _AssociationStereotypeExists-»
	«ELSE-»
		«EXPAND _AssociationStereotypeNotExists-»
	«ENDIF»
	«EXPAND _JoinColumn-»
«ENDDEFINE»

«REM»
	evaluates association stereotype
«ENDREM»
«DEFINE _AssociationStereotypeExists FOR MAssociationRole-»
	«IF !hasTaggedValue("ejb3Association", "type", "AutoDetect") && hasUtilizableValue("ejb3Association", "type")-»
		«REM»
			evaluation is easy if stereotype "ejb3Association" and 
			tagged value "type" are set 
		«ENDREM»		
		«IF hasTaggedValue("ejb3Association", "type", "OneToOne")»
			@OneToOne«EXPAND _EvaluateAssociationTaggedValues-»
		«ENDIF»
		
		«IF hasTaggedValue("ejb3Association", "type", "OneToMany")»
			@OneToMany«EXPAND _EvaluateAssociationTaggedValues-»
			«EXPAND _JoinTable»
		«ENDIF»
		
		«IF hasTaggedValue("ejb3Association", "type", "ManyToOne")»
			@ManyToOne«EXPAND _EvaluateAssociationTaggedValues-»
			«EXPAND _JoinTable»
		«ENDIF»
		
		«IF hasTaggedValue("ejb3Association", "type", "ManyToMany")»
			@ManyToMany«EXPAND _EvaluateAssociationTaggedValues-»
			«EXPAND _JoinTable»
		«ENDIF»			
	«ELSEIF opposite != null-»
		«REM» 
			even with existing stereotype "ejb3Association" the tagged value
			"type" does not have to be set if association is bidirectional.
			check if opposite has an association stereotype
		«ENDREM»
		«IF !opposite.hasStereotype("ejb3Association")-»
			«REM»
				opposite has no stereotype "ejb3Association"
				set necessary annotation and add value to tagged value "type" for easy
				evaluation of the opposite association later in the generation process. 
			«ENDREM»
			«IF multiplicity == 1-»
				«IF opposite.multiplicity == 1-»
					«setTaggedValue(this, "type", "OneToOne") ->""-»
				«ELSE-»
					«setTaggedValue(this, "type", "ManyToOne") ->""-»					
				«ENDIF-»
			«ELSE-»
				«IF opposite.multiplicity == 1-»
					«setTaggedValue(this, "type", "OneToMany") ->""-»
				«ELSE-»
					«setTaggedValue(this, "type", "ManyToMany") ->""-»	
				«ENDIF-»				
			«ENDIF-»
			@«getTaggedValue("ejb3Association", "type")-»«EXPAND _EvaluateAssociationTaggedValues-»
			«IF !hasTaggedValue("ejb3Association", "type", "OneToOne")-»
				«EXPAND _JoinTable»
			«ENDIF-»
		«ELSE-»
			«REM»
				only one side of the association (the opposite) have been provided with an stereotype
				by the user, so let's find out what has to be annotated on this side of the association
			«ENDREM»
			«EXPAND _EvaluateOppositeStereotype-»
		«ENDIF-»
	«ENDIF»
«ENDDEFINE»

«REM»
	evaluates association to generate annotations automatically
«ENDREM»
«DEFINE _AssociationStereotypeNotExists FOR MAssociationRole-»
	«REM»
		MAssociationRole has no association stereotype 
		automatic annotation, not possible for unidirectional association because 
		opposite attribute is not available and can not be evaluated
	«ENDREM»
	«IF opposite != null-»
		«REM»
			bidirectional
			check if opposite has an association stereotype
		«ENDREM»
		«IF !opposite.hasStereotype("ejb3Association")-»
			«REM»
				opposite has no stereotype "ejb3Association"
				set necessary annotation and add stereotype to the opposite for easy
				evaluation of the opposite association later in the generation process. 
				Generation can not have been there because in this case this association 
				site would have had a stereotype. Tagged value "mappedBy" is set on this 
				site thus no "mappedBy" is set to the new stereotype (exception: @ManyToOne)
			«ENDREM»
			«IF multiplicity == 1-»
				«IF opposite.multiplicity == 1-»
					«addAssociationStereotype(this, "OneToOne", "null", "[]", "DEFAULT", "true", opposite.asAttribute()) ->""-»
					@OneToOne«EXPAND _EvaluateAssociationTaggedValues-»
					«addAssociationStereotype(opposite, "OneToOne", "null", "[]", "DEFAULT", "true", "null") ->""-»
					«EXPAND _JoinTable»
				«ELSE-»
					«addAssociationStereotype(this, "OneToMany", "null", "[]", "DEFAULT", "true", opposite.asAttribute()) ->""-»
					@OneToMany«EXPAND _EvaluateAssociationTaggedValues-»
					«addAssociationStereotype(opposite, "ManyToOne", "null", "[]", "DEFAULT", "true", "null") ->""-»
					«EXPAND _JoinTable»
				«ENDIF-»
			«ELSE-»
				«IF opposite.multiplicity == 1-»
					«addAssociationStereotype(this, "ManyToOne", "null", "[]", "DEFAULT", "true", "null") ->""-»
					@ManyToOne«EXPAND _EvaluateAssociationTaggedValues-»
					«addAssociationStereotype(opposite, "OneToMany", "null", "[]", "DEFAULT", "true", asAttribute()) ->""-»
					«EXPAND _JoinTable»			
				«ELSE-»
					«addAssociationStereotype(this, "ManyToMany", "null", "[]", "DEFAULT", "true", opposite.asAttribute()) ->""-»
					@ManyToMany«EXPAND _EvaluateAssociationTaggedValues-»
					«addAssociationStereotype(opposite, "ManyToMany", "null", "[]", "DEFAULT", "true", "null") ->""-»
					«EXPAND _JoinTable»
				«ENDIF-»				
			«ENDIF-»
		«ELSE-»
			«REM»
				only the opposite of the association have been provided with an stereotype by the
				user, so let's find out what has to be annotated on this side of the association
			«ENDREM»
			«EXPAND _EvaluateOppositeStereotype-»
		«ENDIF-»		
	«ENDIF»
«ENDDEFINE»

«REM»
	evaluates stereotype "ejb3Association", tagged value "type" and "mappedBy"
«ENDREM»
«DEFINE _EvaluateOppositeStereotype FOR MAssociationRole-»
	«IF 	opposite.hasTaggedValue("ejb3Association", "type", "AutoDetect") || 
			!opposite.hasUtilizableValue("ejb3Association", "type")-»
		«IF multiplicity == 1-»
			«IF opposite.multiplicity == 1-»
				«IF opposite.hasUtilizableValue("ejb3Association", "mappedBy")-»	
					«IF hasStereotype("ejb3Association")-»
						«setTaggedValue(this, "mappedBy", opposite.asAttribute()) ->""-»
					«ELSE-»
						«addAssociationStereotype(this, "OneToOne", "null", "[]", "DEFAULT", "true", opposite.asAttribute()) ->""-»
					«ENDIF-»	
				«ENDIF-»	
				«setTaggedValue(opposite, "type", "OneToOne") ->""-»
				@OneToOne«EXPAND _EvaluateAssociationTaggedValues-»
			«ELSE-»
				«IF !hasStereotype("ejb3Association")-»
					«addAssociationStereotype(this, "ManyToOne", "null", "[]", "DEFAULT", "true", "null") ->""-»
				«ENDIF-»	
				«setTaggedValue(opposite, "type", "OneToMany") ->""-»
				«setTaggedValue(opposite, "mappedBy", asAttribute()) ->""-»
				@ManyToOne«EXPAND _EvaluateAssociationTaggedValues-»
				«EXPAND _JoinTable»
			«ENDIF-»
		«ELSE-»
			«IF opposite.multiplicity == 1-»
				«IF opposite.hasUtilizableValue("ejb3Association", "mappedBy")-»	
					«IF hasStereotype("ejb3Association")-»
						«setTaggedValue(this, "mappedBy", opposite.asAttribute()) ->""-»
					«ELSE-»
						«addAssociationStereotype(this, "OneToMany", "null", "[]", "DEFAULT", "true", opposite.asAttribute()) ->""-»
					«ENDIF-»
				«ENDIF-»
				«setTaggedValue(opposite, "type", "ManyToOne") ->""-»
				@OneToMany«EXPAND _EvaluateAssociationTaggedValues-»		
				«EXPAND _JoinTable»
			«ELSE-»
				«IF opposite.hasUtilizableValue("ejb3Association", "mappedBy")-»	
					«IF hasStereotype("ejb3Association")-»
						«setTaggedValue(this, "mappedBy", opposite.asAttribute()) ->""-»
					«ELSE-»
						«addAssociationStereotype(this, "ManyToMany", "null", "[]", "DEFAULT", "true", opposite.asAttribute()) ->""-»
					«ENDIF-»
				«ENDIF-»
				«setTaggedValue(opposite, "type", "ManyToMany") ->""-»
				@ManyToMany«EXPAND _EvaluateAssociationTaggedValues-»
				«EXPAND _JoinTable»
			«ENDIF-»				
		«ENDIF-»	
	«ELSE-»
		«IF opposite.hasTaggedValue("ejb3Association", "associationyType", "OneToOne")-»
			«IF opposite.hasUtilizableValue("ejb3Association", "mappedBy")-»
				«IF hasStereotype("ejb3Association")-»
					«setTaggedValue(this, "mappedBy", opposite.asAttribute()) ->""-»
				«ELSE-»
					«addAssociationStereotype(this, "OneToOne", "null", "[]", "DEFAULT", "true", opposite.asAttribute()) ->""-»
				«ENDIF-»
			«ELSE-»
				«addAssociationStereotype(this, "OneToOne", "null", "[]", "", "true", "null") ->""-»
			«ENDIF-»		
			@OneToOne«EXPAND _EvaluateAssociationTaggedValues-»
		«ELSEIF opposite.hasTaggedValue("ejb3Association", "type", "OneToMany")-»
			«IF !hasStereotype("ejb3Association")-»
				«addAssociationStereotype(this, "ManyToOne", "null", "[]", "DEFAULT", "true", "null") ->""-»
			«ENDIF-»	
			@ManyToOne«EXPAND _EvaluateAssociationTaggedValues-»			
			«EXPAND _JoinTable»
		«ELSEIF opposite.hasTaggedValue("ejb3Association", "type", "ManyToOne")-»
			«IF (opposite.hasTaggedValue("ejb3Association", "mappedBy", "null") || opposite.hasTaggedValue("ejb3Association", "mappedBy", ""))-»
				«IF hasStereotype("ejb3Association")-»
					«setTaggedValue(this, "mappedBy", opposite.asAttribute()) ->""-»
				«ELSE-»
					«addAssociationStereotype(this, "OneToMany", "null", "[]", "DEFAULT", "true", opposite.asAttribute()) ->""-»
				«ENDIF-»	
			«ELSE-»
				«addAssociationStereotype(this, "OneToMany", "null", "[]", "DEFAULT", "true", "null") ->""-»
			«ENDIF-»		
			@OneToMany«EXPAND _EvaluateAssociationTaggedValues-»
			«EXPAND _JoinTable»
		«ELSEIF opposite.hasTaggedValue("ejb3Association", "type", "ManyToMany")-»
			«IF opposite.hasUtilizableValue("ejb3Association", "mappedBy")-»
				«IF hasStereotype("ejb3Association")-»
					«setTaggedValue(this, "mappedBy", opposite.asAttribute()) ->""-»
				«ELSE-»
					«addAssociationStereotype(this, "ManyToMany", "null", "[]", "DEFAULT", "true", opposite.asAttribute()) ->""-»
				«ENDIF-»
			«ELSE-»
				«addAssociationStereotype(this, "ManyToMany", "null", "[]", "DEFAULT", "true", "null") ->""-»
			«ENDIF-»		
			@ManyToMany«EXPAND _EvaluateAssociationTaggedValues-»
			«EXPAND _JoinTable»			
		«ENDIF-»
	«ENDIF-»
«ENDDEFINE»

«REM»
	evaluates the taggedValues of the stereotype ejb3Association
«ENDREM»
«DEFINE _EvaluateAssociationTaggedValues FOR MAssociationRole-»	
	(cascade={
	«IF hasUtilizableValue("ejb3Association", "cascade")-»
		«FOREACH getTaggedValue("ejb3Association", "cascade").getElements() AS cascades SEPARATOR ", "-»
			CascadeType.«cascades-»
		«ENDFOREACH-»
	«ENDIF-»}
	«IF hasUtilizableValue("ejb3Association", "targetEntity")-»
		, targetEntity="«getTaggedValue("ejb3Association", "targetEntity")-»"
	«ENDIF-»
	«IF !hasTaggedValue("ejb3Association", "fetch", "DEFAULT")-»
		, fetch=FetchType.«getTaggedValue("ejb3Association", "fetch")-»
	«ENDIF-»
	«IF ( hasTaggedValue("ejb3Association", "type", "OneToOne") && hasTaggedValue("ejb3Association", "optional", "false") )-»
		, optional=false
	«ENDIF-»
	«IF !hasTaggedValue("ejb3Association", "type", "ManyToOne")-»
		«IF hasUtilizableValue("ejb3Association", "mappedBy")-»
			, mappedBy="«getTaggedValue("ejb3Association", "mappedBy")-»"
		«ELSEIF opposite != null-»
			«IF opposite.hasStereotype("ejb3Association")-»
				«IF	!opposite.hasUtilizableValue("ejb3Association", "mappedBy")-»
					«setTaggedValue(this, "mappedBy", opposite.asAttribute()) ->""-»
					, mappedBy="«getTaggedValue("ejb3Association", "mappedBy")-»"			
				«ENDIF-»
			«ELSEIF hasStereotype("ejb3Association") && !hasUtilizableValue("ejb3Association", "mappedBy")-»
				«setTaggedValue(this, "mappedBy", opposite.asAttribute()) ->""-»
				, mappedBy="«getTaggedValue("ejb3Association", "mappedBy")-»"
			«ENDIF-»	
		«ENDIF-»
	«ENDIF-»)
«ENDDEFINE»

«REM» 
	evaluates the stereotype ejb3JoinColumn 
«ENDREM»
«DEFINE _JoinColumn FOR MAssociationRole-»
	«IF hasStereotype("ejb3JoinColumn")»
		«IF hasUtilizableValue("ejb3JoinColumn", "name")»
			@JoinColumn(name="«getTaggedValue("ejb3JoinColumn", "name")-»"
			«IF hasUtilizableValue("ejb3JoinColumn", "referencedColumnName")-»
				, referencedColumnName="«getTaggedValue("ejb3JoinColumn", "referencedName")-»"
			«ENDIF-»
			«IF hasUtilizableValue("ejb3JoinColumn", "table")-»
				, table="«getTaggedValue("ejb3JoinColumn", "table")-»"
			«ENDIF-»
			«IF hasUtilizableValue("ejb3JoinColumn", "columnDefinition")-»
				, columnDefinition="«getTaggedValue("ejb3JoinColumn", "columnDefinition")-»"
			«ENDIF-»
			«IF hasTaggedValue("ejb3JoinColumn", "nullable", "false") && !hasTaggedValue("ejb3JoinColumn", "unique", "true")-»
				, nullable=«getTaggedValue("ejb3JoinColumn", "nullable")-»
			«ENDIF-»
			«IF hasTaggedValue("ejb3JoinColumn", "insertable", "false")-»
				, insertable=false
			«ENDIF-»
			«IF hasTaggedValue("ejb3JoinColumn", "updatable", "false")-»
				, updatable=false
			«ENDIF-»
			«IF hasTaggedValue("ejb3JoinColumn", "unique", "true")-»-»
				, unique=true, nullable=false
			«ENDIF-»
			)
		«ENDIF»
	«ENDIF»
«ENDDEFINE»

«REM» 
	evaluates the stereotype ejb3IJoinColumn 
«ENDREM»
«DEFINE _IJoinColumn FOR MAssociationRole-»
	«IF hasStereotype("ejb3IJoinColumn")»
		«IF hasUtilizableValue("ejb3IJoinColumn", "name")»
			@JoinColumn(name="«getTaggedValue("ejb3IJoinColumn", "name")-»"
			«IF hasUtilizableValue("ejb3IJoinColumn", "referencedColumnName")-»
				, referencedColumnName="«getTaggedValue("ejb3IJoinColumn", "referencedName")-»"
			«ENDIF-»
			«IF hasUtilizableValue("ejb3IJoinColumn", "table")-»
				, table="«getTaggedValue("ejb3IJoinColumn", "table")-»"
			«ENDIF-»
			«IF hasUtilizableValue("ejb3JoinColumn", "columnDefinition")-»
				, columnDefinition="«getTaggedValue("ejb3IJoinColumn", "columnDefinition")-»"
			«ENDIF-»
			«IF hasTaggedValue("ejb3IJoinColumn", "nullable", "false") && !hasTaggedValue("ejb3IJoinColumn", "unique", "true")-»
				, nullable=«getTaggedValue("ejb3IJoinColumn", "nullable")-»
			«ENDIF-»
			«IF hasTaggedValue("ejb3IJoinColumn", "insertable", "false")-»
				, insertable=false
			«ENDIF-»
			«IF hasTaggedValue("ejb3IJoinColumn", "updatable", "false")-»
				, updatable=false
			«ENDIF-»
			«IF hasTaggedValue("ejb3IJoinColumn", "unique", "true")-»-»
				, unique=true, nullable=false
			«ENDIF-»
			)
		«ENDIF»
	«ENDIF»
«ENDDEFINE»

«REM» 
	evaluates the stereotype ejb3JoinTable 
«ENDREM»
«DEFINE _JoinTable FOR MAssociationRole-»
	«IF hasStereotype("ejb3JoinTable")»
		«IF hasUtilizableValue("ejb3JoinTable", "name")-»
			@JoinTable(name="«getTaggedValue("ejb3JoinTable", "name")-»"
			«IF hasStereotype("ejb3JoinColumn")-»
				, joinColumns=
				«EXPAND _JoinColumn-»
			«ENDIF-»
			«IF hasStereotype("ejb3IJoinColumn")-»
				, inverseJoinColumns=
				«EXPAND _IJoinColumn-»
			«ENDIF»
			)
		«ENDIF»
	«ENDIF»
«ENDDEFINE»

«REM»
	functions from old association handling ( < GeneSEZ 1.5 )
	there are needed for the ejb3 cartridge 
«ENDREM»
«REM»
«DEFINE _AssocClassReferences FOR MAssociation-»
	«FOREACH end AS aend-»
		/** reference attribute to the managed association end */
		private «aend.type.asTypeName()-» «aend.asAttribute()-»;
	«ENDFOREACH-»
«ENDDEFINE»
«ENDREM»

«DEFINE _CommentAssociation FOR MAssociationRole-»
	/**
	 * variable for association to «this.type.asTypeName()»
	 */
«ENDDEFINE»

«REM»
	 generate modifiers for mclassifier
«ENDREM»
«DEFINE _Modifier FOR MAssociationRole-»
	«visibility-»
«ENDDEFINE»


«DEFINE AccessorDecl FOR MInterface-»
	«FOREACH property.typeSelect(MAssociationRole) AS a-»
		«EXPAND GetterDecl FOR a-»
		«EXPAND InsertInDecl FOR a-»
		«EXPAND RemoveFromDecl FOR a-»
	«ENDFOREACH-»
«ENDDEFINE»

«DEFINE AccessorImpl FOR MClass-»
	«REM»«EXPAND _AssocClassReferenceGetters FOR ownedAssociation-»«ENDREM»
	«FOREACH property.typeSelect(MAssociationRole) AS a-»
		«EXPAND GetterImpl FOR a-»
		«EXPAND InsertInImpl FOR a-»
		«EXPAND RemoveFromImpl FOR a-»
	«ENDFOREACH-»
«ENDDEFINE»

«REM»
	generate a getter declaration method for a MAssociationRole
«ENDREM»
«DEFINE GetterDecl FOR MAssociationRole-»
	«EXPAND _CommentGetter-»
	«IF isPlainAssociation()-»
		«IF multiplicity != 1-»
			public «mapType()»<«type.asTypeName()»> «asGetter()»();
		«ENDIF-»
	«ELSE-»
		public «mapType()»<«type.asTypeName()»> «asGetter()»();
		public «mapType()»<«type.asTypeName()»> «asGetter()»«type.asTypeName()»();
	«ENDIF-»
«ENDDEFINE»


// generate a getter implementation method for a MAssociationRole
«DEFINE GetterImpl FOR MAssociationRole-»
	«IF isPlainAssociation()-»
		«IF multiplicity == 1-»
			public «type.asTypeName()» «asGetter()»() {
				return «asAttribute()»;
			}
		«ELSE-»
			public «mapType()»<«type.asTypeName()»> «asGetter()»() {
				«IF unique == true-»
					return java.util.Collections.unmodifiableSet(«asAttribute()»);
				«ELSE-»
					return java.util.Collections.unmodifiableSet(«asAttribute()»);
				«ENDIF-»
			}
		«ENDIF-»
	«ELSE-»
		«REM»public «mapType()»<«type.asTypeName()»> «asGetter()»() {
			«mapType("Implementation")»<«type.asTypeName()»> _result = new «mapType("Implementation")»<«type.asTypeName()»>();
			for(«type.asTypeName()» _assoc : «asAttribute()») {
				_result.add(_assoc.«asGetter()»());
			}
			return _result;
		}
		
		/** 
		  * accessor to the association class objects
		  */
		public «mapType()»<«type.asTypeName()»> «asGetter()»«type.asTypeName()»() {
			«IF unique == true-»
				return java.util.Collections.unmodifiableSet(«asAttribute()»);
			«ELSE-»
				return java.util.Collections.unmodifiableSet(«asAttribute()»);
			«ENDIF-»
		}«ENDREM»
	«ENDIF-»
«ENDDEFINE»

// generate a insert in declaration method
«DEFINE InsertInDecl FOR MAssociationRole-»
	«EXPAND _CommentAccessor-»
	«IF isPlainAssociation()-»
		«IF multiplicity != 1-»
			public void «asInsertIn()-»(«type.asTypeName()» «asAttribute()-»);
		«ELSEIF multiplicity == 1»
			public void «asSetter()-»(«type.asTypeName()» «asAttribute()-»);
		«ENDIF»
	«ELSE-»
		«REM»public void «asInsertIn()»(«type.asTypeName()» _in, «type.asTypeName()» _at);«ENDREM»
	«ENDIF-»
«ENDDEFINE»


// generate a insert in implementation method
«DEFINE InsertInImpl FOR MAssociationRole-»
	«EXPAND _CommentAccessor-»
	«IF isPlainAssociation()-»
		«IF multiplicity != 1-»
			public void «asInsertIn()-»(«type.asTypeName()-» «asAttribute()-») {
				«IF multiplicity == 1-»
					if (this.«asAttribute()-» == «asAttribute()-») {
						return;
					}
					«IF opposite != null && opposite.multiplicity != 1-»
						if (this.«asAttribute()-» != null) {
							this.«asAttribute()-».«opposite.asRemoveFrom()-»(this);
						}
					«ENDIF-»
					this.«asAttribute()-» = «asAttribute()-»;
				«ELSE-»
					if (this.«asAttribute()-».contains(«asAttribute()-»)) {
						return;
					}
					this.«asAttribute()-».add(«asAttribute()-»);
				«ENDIF-»
				«IF opposite != null && opposite.multiplicity != 1 
					&& (opposite.hasTaggedValue("accessor", "setter", "true")
						|| !opposite.hasStereotype("accessor"))-»
					«asAttribute()-».«opposite.asInsertIn()-»(this);
				«ELSEIF opposite != null && opposite.multiplicity == 1 
						&& (opposite.hasTaggedValue("accessor", "setter", "true") 
							|| !opposite.hasStereotype("accessor"))-»
					«asAttribute()-».«opposite.asSetter()-»(this);
				«ENDIF-»
			}
		«ELSEIF multiplicity == 1»
			«EXPAND _CommentAccessor-»
			public void «asSetter()-»(«type.asTypeName()-» «asAttribute()-»){
				this.«asAttribute()-» = «asAttribute()-»; 
			}
		«ENDIF»
	«ELSE-»
		«REM»/**
		  * insert into association, generate linked association class object
		  * @param _other partner object
		  * @return newly generated linked association class object
		  */
		public «type.asTypeName()» «asInsertIn()»(«type.asTypeName()» _other) {
			«IF association.end.first() != this-»
				«type.asTypeName()» _assoc = new «type.asTypeName()»(this, _other);
			«ELSE-»
				«assocClass().mapName()» _assoc = new «type.asTypeName()»(_other, this);
			«ENDIF-»
			this.«asVariable()».add(_assoc);
		«IF opposite != null-»
			_other.«opposite.asInsertIn()»(_assoc); 
		«ENDIF-»
			return _assoc;
		}
		
		/**
		  * insert linked association class object into association
		  * @param _other partner object
		  * @return newly generated linked association class object
		  */
		public void «asInsertIn()»(«type.asTypeName()» _assoc) {
			if (this.«asAttribute()».contains(_assoc)) {
					return;
			}
			if(_assoc.«opposite.asGetter()»() != this) {
				throw new RuntimeException("inconsistent association object");
			}
			this.«asAttribute()».add(_assoc);
		}«ENDREM»
	«ENDIF-»
«ENDDEFINE»


// generate a remove from declaration method
«DEFINE RemoveFromDecl FOR MAssociationRole-»
	«EXPAND _CommentAccessor-»
	«IF multiplicity != 1-»
		public void «asRemoveFrom()-»(«type.asTypeName()-» «asAttribute()-»);
	«ENDIF»
«ENDDEFINE»


// generate a remove from implementation method
«DEFINE RemoveFromImpl FOR MAssociationRole-»
	«EXPAND _CommentAccessor-»
	«IF isPlainAssociation()-»
		«IF multiplicity != 1-»
			public void «asRemoveFrom()-»(«type.asTypeName()-» «asAttribute()-») {
				«IF multiplicity == 1-»
					if (this.«asAttribute()-» != «asAttribute()-») {
						return;
					}
					this.«asAttribute()-» = null;
				«ELSE-»
					if (!this.«asAttribute()-».contains(«asAttribute()-»)) {
						return;
					}
					this.«asAttribute()-».remove(«asAttribute()-»);
				«ENDIF-»
				«IF opposite != null && opposite.multiplicity != 1-»
					«asAttribute()-».«opposite.asRemoveFrom()-»(this);
				«ENDIF-»
			}
		«ENDIF»
	«ELSE-»
		«REM»/**
		  * remove entry from association indexed by its association class object
		  */
		public void «asRemoveFrom()»(«type.asTypeName()» _assoc) {
			if (!«asAttribute()».contains(_assoc)) {
				return;
			}
			«asAttribute()».remove(_assoc);
			«IF opposite != null-»
				_assoc.«asGetter()»().«opposite.asRemoveFrom()»(_assoc);
			«ENDIF-»
		}«ENDREM»
	«ENDIF-»
«ENDDEFINE»

«DEFINE _CommentGetter FOR MAssociationRole-»
	/**
	 * accessor for association to «name»
	«IF hasComment()-»
		 * «ownedComment.getCommentText()»
	«ENDIF-»
	 */
«ENDDEFINE»

«DEFINE _CommentAccessor FOR MAssociationRole-»
	/**
	 * accessor for association to «name»
	«IF hasComment()-»
	 	* @see {@link «asGetter()»}
	«ENDIF-»
	 */
«ENDDEFINE»

«REM»
«DEFINE _AssocClassReferenceGetters FOR MAssociation-»
	«FOREACH end AS aend-»
		/** getter of reference attribute to the managed association end  «aend.asVariable()»*/
		public «aend.type.asTypeName()» «aend.asGetter()»() {
			return «aend.asVariable()»;
		}
	«ENDFOREACH-»
«ENDDEFINE»
«ENDREM»