package de.genesez.app;/* PROTECTED REGION ID(java.mclassifier.other.import.code_14_0_8a7027a_1203495432297_311152_296) ENABLED START *//* TODO put your imports here */import java.lang.String;import com.avidwireless.avidirector.AVIDirectorMain;import de.genesez.j2meframework.sensors.SensorEvent;import de.genesez.app.sensors.PotSensorController;import de.genesez.app.sensors.PotSensor;import de.genesez.app.actuators.LightEmittingDiode;import de.genesez.j2meframework.sensors.ISensorListener;import de.genesez.app.actuators.Lamp;import com.avidwireless.avidirector.AvidUtil;import com.avidwireless.avidirector.Logger;import com.avidwireless.avidirector.iodevice.M2M_IODevice;/* PROTECTED REGION END *//** * @author nicher */public class CebitApplication extends com.avidwireless.avidirector.M2Mlet implements java.lang.Runnable, com.avidwireless.avidirector.WatchDogMonitoredClass, ISensorListener {		// ////////////////////////////////////////////////////////////////////////	// generated variable, constant and association declarations	// ////////////////////////////////////////////////////////////////////////		/** @see {@link getWATCHDOG_TIMEOUT} */	private static final int WATCHDOG_TIMEOUT = 120000;	private com.avidwireless.avidirector.WatchDogTimer watchDogTimer;	private long lastTimeRan = 0;	private boolean threadRunning = false;	private java.lang.Thread thread;	/**	 * variable for association to lamp	 */	private Lamp lamp;	/**	 * variable for association to greenLED	 */	private LightEmittingDiode greenLED;	/**	 * variable for association to redLED	 */	private LightEmittingDiode redLED;	/**	 * variable for association to pot	 */	private PotSensor pot;		// ////////////////////////////////////////////////////////////////////////	// generated constructor implementations	// ////////////////////////////////////////////////////////////////////////		/**	 * @return  	 */	public CebitApplication() {		/* PROTECTED REGION ID(java.moperation.implementation.operation.code._14_0_8a7027a_1203503259600_761414_1430) ENABLED START */		/* TODO put your own implementation code here */		/* PROTECTED REGION END */	}		// ////////////////////////////////////////////////////////////////////////	// generated derived attribute method implementations	// ////////////////////////////////////////////////////////////////////////		// ////////////////////////////////////////////////////////////////////////	// generated association method implementations	// ////////////////////////////////////////////////////////////////////////		/**	 * accessor for association to lamp	 */	public Lamp getLamp() {		return lamp;	}		/**	 * accessor for association to lamp	 */	public void insertInLamp(Lamp _in) {		if (lamp == _in) {			return;		}		lamp = _in;	}		/**	 * accessor for association to lamp	 */	public void removeFromLamp(Lamp _ex) {		if (lamp != _ex) {			return;		}		lamp = null;	}		/**	 * accessor for association to greenLED	 */	public LightEmittingDiode getGreenLED() {		return greenLED;	}		/**	 * accessor for association to greenLED	 */	public void insertInGreenLED(LightEmittingDiode _in) {		if (greenLED == _in) {			return;		}		greenLED = _in;	}		/**	 * accessor for association to greenLED	 */	public void removeFromGreenLED(LightEmittingDiode _ex) {		if (greenLED != _ex) {			return;		}		greenLED = null;	}		/**	 * accessor for association to redLED	 */	public LightEmittingDiode getRedLED() {		return redLED;	}		/**	 * accessor for association to redLED	 */	public void insertInRedLED(LightEmittingDiode _in) {		if (redLED == _in) {			return;		}		redLED = _in;	}		/**	 * accessor for association to redLED	 */	public void removeFromRedLED(LightEmittingDiode _ex) {		if (redLED != _ex) {			return;		}		redLED = null;	}		/**	 * accessor for association to pot	 */	public PotSensor getPot() {		return pot;	}		/**	 * accessor for association to pot	 */	public void insertInPot(PotSensor _in) {		if (pot == _in) {			return;		}		pot = _in;	}		/**	 * accessor for association to pot	 */	public void removeFromPot(PotSensor _ex) {		if (pot != _ex) {			return;		}		pot = null;	}		// ////////////////////////////////////////////////////////////////////////	// generated abstract method declaration	// ////////////////////////////////////////////////////////////////////////		// ////////////////////////////////////////////////////////////////////////	// generated normal method implementations	// ////////////////////////////////////////////////////////////////////////		/**	 * @param  e  	 */	public void receiveMeasureValue(SensorEvent e) {				/* PROTECTED REGION ID(java.moperation.implementation.operation.code._14_0_8a7027a_1203516660050_206025_1079) ENABLED START */		/* TODO put your own implementation code here */		float value = e.getMeasureValue();				// regulate the light bulb		lamp.regulate(value / 66);				// regulate the green and the red led		if (value <= 3000) {			greenLED.regulate(1);			redLED.regulate(0);		} else {			greenLED.regulate(0);			redLED.regulate(1);		}				/* PROTECTED REGION END */	}		// ////////////////////////////////////////////////////////////////////////	// generated getter and setter method implementations	// ////////////////////////////////////////////////////////////////////////		/**	 * The Watchdog timer timeout in milliseconds.	 */	public static int getWATCHDOG_TIMEOUT() {		return WATCHDOG_TIMEOUT;	}		public com.avidwireless.avidirector.WatchDogTimer getWatchDogTimer() {		return watchDogTimer;	}		public void setWatchDogTimer(com.avidwireless.avidirector.WatchDogTimer _watchDogTimer) {		watchDogTimer = _watchDogTimer;	}		public long getLastTimeRan() {		return lastTimeRan;	}		public void setLastTimeRan(long _lastTimeRan) {		lastTimeRan = _lastTimeRan;	}		public boolean getThreadRunning() {		return threadRunning;	}		public void setThreadRunning(boolean _threadRunning) {		threadRunning = _threadRunning;	}		public java.lang.Thread getThread() {		return thread;	}		public void setThread(java.lang.Thread _thread) {		thread = _thread;	}		// ////////////////////////////////////////////////////////////////////////	// own implementations	// ////////////////////////////////////////////////////////////////////////		/* PROTECTED REGION ID(java.mclassifier.implementation.owncode.code._14_0_8a7027a_1203495432297_311152_296) ENABLED START */	/* TODO put your own implementation code here */	public String getAppName() {		return "Cebit pot application";	}		public String getDescription() {		return "Cebit pot application which is generated with mdsd";	}		/**	 * Starts the program for the Simulator board. This creates any initial	 * devices and sets them to defined states.	 * 	 * @param adApp	Inistance of the AVIDirectorMain application	 */	public boolean start(AVIDirectorMain adApp) {		Logger.log(getAppName(), "Starting");				started = false;		app = adApp;				try {			// TTL1 is analog input with a potentometer			pot = new PotSensor(Integer.toString(M2M_IODevice.TTL1), app);						// Bind pot controller to pot sensor			PotSensorController psc = new PotSensorController(pot);			pot.insertInSensorController(psc);						// TTL2 is the light bulb			lamp = new Lamp(Integer.toString(M2M_IODevice.TTL2), app);						// TTL3 is the green LED			greenLED = new LightEmittingDiode(Integer.toString(M2M_IODevice.TTL3), app);						// TTL4 is the red LED			redLED = new LightEmittingDiode(Integer.toString(M2M_IODevice.TTL4), app);						// add listener to pot controller			psc.insertInSensorListener(this);						// start this thread running			started = true;			thread = new Thread(this);						// Now wait for a signal that it has started			synchronized (this) {				try {					thread.start();					this.wait(30000); // 30 seconds to get going				} catch (InterruptedException e) {					Logger.log(getAppName(), "InterruptedException starting Thread");				}			}						Logger.log(getAppName(), "Started");		} // try		catch (Exception e) {			Logger.debugln(getAppName(), e);		}		return started;	}		/**	 * Stops the currently executing Cebit programm. This will try to do any	 * cleanup possible.	 * 	 */	public void stop() {		Logger.log(getAppName(), "Stopping");				// destroy objects		threadRunning = false;		pot = null;		lamp = null;		greenLED = null;		redLED = null;				// stop the watchdog from staring at us		if (watchDogTimer != null) {			watchDogTimer.removeMonitoredItem(this);			watchDogTimer = null;		}				Logger.log(getAppName(), "Stopped");	}		/**	 * This thread monitors the test box's switches and dials and if something	 * has changed it displays a message on the display and sends a message to	 * the M2MXML portal.	 */	public void run() {		Logger.log(getAppName(), "Running");				Thread.currentThread().setName(getAppName());				// notify out start method that we are running		threadRunning = true;		synchronized (this) {			this.notifyAll();		}				if (started) {			Logger.debugln(getAppName(), "Thread started");						// lcd.displayMessage("Monitoring...");			//			double value; // currently read value from a sensor			//			double lightIntensity; // value of the light (0-62)			//			StringBuffer perceptMessage; // Percept reading to Portal			//			boolean retFlag; // return status of a command			//			boolean triggerResponse; // set true if there is a change of			//										// value			//			double ttl1Value = -1, ttl3Value = -1, ttl4Value = -1;			//			long portalUpdateCounter = 0; // timers looking for when to update			//											// the portal			//			boolean updatePortal;			//			//			perceptMessage = new StringBuffer(256);						// Monitor this running with a watchdog timer, and check in every 60			// seconds (at least)			watchDogTimer = app.getWatchDogTimer();			watchDogTimer.registerWatchDogMonitoredItem(this, getAppName(), WATCHDOG_TIMEOUT);			//int watchDogTimerCounter = 0; // used to track when to update						while (threadRunning) {								watchDogTimer.resetWatchDogTimer(this);				//lastTimeRan = System.currentTimeMillis();								// go through the sensors and send a new reading if it changed								// see if we need to poll now				//				if ((portalUpdateInterval > 0) && ((System.currentTimeMillis() - portalUpdateCounter) >= portalUpdateInterval)) {				//					updatePortal = true;				//					portalUpdateCounter = System.currentTimeMillis();				//					if (isDebug)				//						Logger.debugln(NAME, "Updating Portal");				//					// get the RSSI				//					watchDogTimer.resetWatchDogTimer(this); // pet the watch dog				//					// - don't make her				//					// byte!				//					watchDogTimerCounter = 0;				//				} else {				//					updatePortal = false;				//					// update the watchdog timer every 300 clicks or so				//					if (watchDogTimerCounter++ > 300) {				//						watchDogTimerCounter = 0;				//						// if (ttl4Value != 1)				//						watchDogTimer.resetWatchDogTimer(this); // pet the watch				//						// dog - don't				//						// make her				//						// byte!				//					}				//				}								// let the pot measure				pot.measure();								// update every 500 ms				if (threadRunning) {					AvidUtil.waitHereMs(500);				}			} // while thread running			Logger.debugln(getAppName(), "Thread stopped");		} else {			Logger.log(getAppName(), "Not started so cannot run thread. Exiting");		}		Logger.log(getAppName(), "Runned");	}		/* PROTECTED REGION END */}