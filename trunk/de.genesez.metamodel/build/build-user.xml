<?xml version="1.0" ?>
<!--
	ant build file for automation of model transformation steps
	@author	dreamer
	
	includes following ant tasks:
	- oaw workflow task to generate *.ecore file from emf uml2 model
	  [ uml2ecore ]
	- ecore code generation task to generate the *.genmodel file and
	  the java metamodel implementation
	  [ ecore2java ]
	- creates a jar library which contains the java metamodel implementation classes
	  [ genesezmm2jar ]
	
	note: it's a kind of an abstract build file
-->

<project name="de.genesez.metamodel" basedir=".." default="">
	
	<!--
		include oaw properties + build properties
	-->
	<property file="build/build.properties" />
	
	<!--
		include genesez metamodel classpath
		provides classpathref 'de.genesez.metamodel.classpath'
	-->
	<import file="build-cp.xml" />

	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	
	<!-- compile required java classes -->
	<target name="compile">
		<mkdir dir="${basedir}/bin" />
		<javac srcdir="${basedir}/src"
			destdir="${basedir}/bin"
			classpathref="de.genesez.metamodel.classpath"
			debug="on" />
	</target>
	
	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
	
	<!-- oaw workflow task definition -->
	<taskdef name = "oaw.workflow"
		classname = "org.openarchitectureware.workflow.ant.WorkflowAntTask"
		classpathref = "de.genesez.metamodel.classpath" />
	
	<!-- transform emf uml2 models to ecore models using oaw workflow -->
	<target name="uml2ecore" depends="compile" >
		<!-- workflow task is derived from the java ant task -->
		<oaw.workflow file = "${oaw.workflow.file}"
			classpathref="de.genesez.metamodel.classpath"
			fork = "true"
			dir = "${basedir}">
			
			<param name="baseDir" value="${basedir}/" />
		</oaw.workflow>
	</target>	
	
	<!--
		generate *.genmodel + java code impl from *.ecore model
		note: genModel must be set in task and must be generated!
	-->
	<target name = "ecore2java">
		<emf.Ecore2Java model = "${ecoreMetaModelFile}"
			genModel = "${genModelFile}"
			reconcileGenModel="reload"
			
			generateJavaCode="true"
			generateModelProject="false"
			generateEditProject="false"
			generateEditorProject="false"
			
			modelProject = "${basedir}"
			modelProjectFragmentPath = "${ecore2java.path}">
			
			<arg line = "-package ${ecore.package}" />
		</emf.Ecore2Java>
	</target>
	
	<!--
		create jar library
	-->
	<target name="genesezmm2jar"
		description="creates a jar library which contains the genesez metamodel implementation">
		
		<jar destfile="${dist.dir}/genesez-metamodel.jar">
			<fileset dir="${bin.dir}">
				<include name="de/genesez/metamodel/**" />
			</fileset>
			<manifest>
				<section name="de.genesez.metamodel">
					<attribute name="Specification-Title" value="GeneSEZ Metamodel"/>
					<attribute name="Specification-Version" value="1.5.0"/>
					<attribute name="Specification-Vendor" value="Generative Software Engineering Zwickau"/>
					<attribute name="Implementation-Title" value="GeneSEZ Metamodel"/>
					<attribute name="Implementation-Version" value="1.5.0"/> 
					<attribute name="Implementation-Vendor" value="Generative Software Engineering Zwickau"/>
				</section>
			</manifest>
		</jar>
	</target>
	
	<!-- cleaning lady -->
	<target name="clean"
			description="clears the distribution directory">
		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}">
				<include name="**/*" />
			</fileset>
		</delete>
	</target>
</project>
