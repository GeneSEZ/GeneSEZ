<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<project name="de.genesez.manual" basedir=".." default="build">

	<!-- Import project related properties -->
	<property file="build/build.properties" />

	<!-- Public target section -->

	<target name="build"
		description="Build de.genesez.manual"
		depends="manual.db2html, manual.fop2pdf" >
	</target>

	<target name="distribute"
		description="Distribute de.genesez.manual"
		depends="build" >
		<copy todir="${distribution.dir}">
			<fileset dir="${basedir}">
					<include name="${html.dir}/*" />
			</fileset>
		</copy>
		<copy todir="${distribution.dir}/${html.dir}">
			<fileset dir="${basedir}">
					<include name="${images.dir}/*" />
			</fileset>
		</copy>
		<copy todir="${distribution.dir}" file="${docbook.pdf}"/>
	</target>

	<target name="clean"
		description="Clean de.genesez.manual">
		<delete>
			<fileset dir="${basedir}" includes="${docbook.fo}"/>
			<fileset dir="${basedir}" includes="${docbook.pdf}"/>
			<fileset dir="${basedir}" includes="${docbook.tmp}"/>
		</delete>
		<delete dir="${basedir}/${html.dir}" />
	</target>

	<!-- Private target section -->

	<target name="manual">
		<exec executable="${xmllint.bin}">
			<arg value="--xinclude"/>
			<arg value="--output"/>
			<arg value="${docbook.tmp}"/>
			<arg value="${docbook.src}" />
		</exec>
	</target>
	
	<target name="manual.db2html"
		depends="manual">
		<mkdir dir="${basedir}/${html.dir}" />
		<exec executable="${docbook2html.bin}">
			<arg value="--output"/>
			<arg value="${html.dir}"/>
			<arg value="${docbook.tmp}"/>
		</exec>
	</target>

	<target name="manual.db2fop">
		<exec executable="${xsltproc.bin}">
			<arg value="--output"/>
			<arg value="${docbook.fo}"/>
			<arg value="--stringparam"/>
			<arg value="use.extensions"/>
			<arg value="0"/>
			<arg value="--stringparam"/>
			<arg value="fop1.extensions"/>
			<arg value="1"/>
			<arg value="--stringparam"/>
			<arg value="draft.mode"/>
			<arg value="yes"/>
			<arg value="--stringparam"/>
			<arg value="hyphenate"/>
			<arg value="false"/>
			<arg value="--stringparam"/>
			<arg value="l10n.gentext.default.language"/>
			<arg value="de"/>
			<arg value="--stringparam"/>
			<arg value="paper.type"/>
			<arg value="A4"/>
			<arg value="${docbook2fop}"/>
			<arg value="${docbook.tmp}"/>
		</exec>
	</target>

	<target name="manual.fop2pdf"
		depends="manual.db2fop">
		<exec executable="${fop.bin}">
			<arg value="-fo"/>
			<arg value="${docbook.fo}"/>
			<arg value="-pdf"/>
			<arg value="${docbook.pdf}"/>
		</exec>
	</target>

</project>
