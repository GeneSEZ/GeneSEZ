«IMPORT gcore»
«REM»
	Performs the generation of TypoScript "setup.txt".

	@author	Nico Herbig <nico.herbig@fh-zwickau.de>
	@date	2011-07-14
«ENDREM»

«REM» use TYPO3 Extbase convention and conversion scripts «ENDREM»
«EXTENSION de::genesez::platform::typo3::extbase::convention::Convention»
«EXTENSION de::genesez::platform::typo3::extbase::convention::Conversion»

«REM» use TYPO3 Extbase access helper scripts «ENDREM»
«EXTENSION de::genesez::platform::typo3::extbase::scripts::AccessHelper»

«REM»
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
	public functions
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
«ENDREM»

«REM»
	Processes the generation of "setup.txt".
«ENDREM»
«DEFINE Root FOR MModel -»
«FILE setupTxtFilePath() -»
«LET fullQualifiedShortExtensionKey() AS fullQualifiedShortExtensionKey -»
«EXPAND PluginConfiguration(fullQualifiedShortExtensionKey) -»

«EXPAND ModuleConfiguration(fullQualifiedShortExtensionKey) -»

«EXPAND OwnTypoScriptDeclaration("setup.txt.own.typoscript.declaration." + xmiGuid) -»
«ENDLET -»
«ENDFILE»
«ENDDEFINE»


«REM»
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
	private functions
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
«ENDREM»

«DEFINE PluginConfiguration(String fullQualifiedShortExtensionKey) FOR MModel -»
«IF !allPlugins().isEmpty -»
plugin.«fullQualifiedShortExtensionKey -» {
	persistence {
		storagePid = {$plugin.«fullQualifiedShortExtensionKey -».persistence.storagePid}
	}
	view {
		templateRootPath = {$plugin.«fullQualifiedShortExtensionKey -».view.templateRootPath}
		partialRootPath = {$plugin.«fullQualifiedShortExtensionKey -».view.partialRootPath}
		layoutRootPath = {$plugin.«fullQualifiedShortExtensionKey -».view.layoutRootPath}
	}
}
«ENDIF -»
«ENDDEFINE»


«DEFINE ModuleConfiguration(String fullQualifiedShortExtensionKey) FOR MModel -»
«IF !allModules().isEmpty -»
module.«fullQualifiedShortExtensionKey -» {
	persistence = {$module.«fullQualifiedShortExtensionKey -».persistence.storagePid}
	view {
		templateRootPath = {$module.«fullQualifiedShortExtensionKey -».view.templateRootPath}
		partialRootPath = {$module.«fullQualifiedShortExtensionKey -».view.partialRootPath}
		layoutRootPath = {$module.«fullQualifiedShortExtensionKey -».view.layoutRootPath}
	}
}
«ENDIF -»
«ENDDEFINE»


«REM»
	Generates a region for own TypoScript declarations.
«ENDREM»
«DEFINE OwnTypoScriptDeclaration(String id) FOR MModel -»
«PROTECT CSTART '// ' CEND '' ID (id)»
// TODO: put your further TypoScript declarations here
«ENDPROTECT»
«ENDDEFINE»
